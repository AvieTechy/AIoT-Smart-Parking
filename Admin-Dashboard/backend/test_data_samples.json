{
  "session_endpoints": {
    "create_session": {
      "url": "POST /api/sessions/",
      "description": "Tạo session mới - Session vào (In) sẽ tự động nhận diện biển số xe",
      "samples": [
        {
          "name": "Create Entry Session",
          "payload": {
            "plateUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/plates/plate_001.jpg",
            "faceUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/faces/face_001.jpg",
            "gate": "In",
            "faceIndex": "face_embedding_001"
          },
          "expected_response": {
            "success": true,
            "session_id": "123e4567-e89b-12d3-a456-426614174000",
            "message": "Session created for gate: In",
            "note": "plateNumber will be automatically detected and saved for In sessions"
          },
          "workflow": [
            "1. Tạo session với gate='In'",
            "2. Tự động gọi AI nhận diện biển số từ plateUrl",
            "3. Lưu plateNumber vào session",
            "4. Tạo PlateMap mapping plateNumber -> sessionID",
            "5. Update IsNewSession status"
          ]
        },
        {
          "name": "Create Exit Session",
          "payload": {
            "plateUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/plates/plate_002.jpg",
            "faceUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/faces/face_002.jpg",
            "gate": "Out",
            "faceIndex": "face_embedding_002"
          },
          "expected_response": {
            "success": true,
            "session_id": "987fcdeb-51d8-43a7-b123-987654321000",
            "message": "Session created for gate: Out",
            "note": "plateNumber will be null for Out sessions (use /api/sessions/out endpoint instead)"
          },
          "workflow": [
            "1. Tạo session với gate='Out'",
            "2. plateNumber = null (không tự động nhận diện)",
            "3. Cần sử dụng endpoint /api/sessions/out để tạo exit session với plateNumber từ entry session"
          ]
        }
      ]
    },
    "create_out_session": {
      "url": "POST /api/sessions/out",
      "description": "Tạo session cho xe ra với thông tin từ session vào",
      "samples": [
        {
          "name": "Create Out Session with Entry Data",
          "payload": {
            "plateUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/plates/plate_exit_001.jpg",
            "faceUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/faces/face_exit_001.jpg",
            "faceIndex": "face_embedding_001",
            "plateNumber": "29A-12345"
          }
        }
      ]
    },
    "get_session": {
      "url": "GET /api/sessions/{session_id}",
      "description": "Lấy thông tin session theo ID",
      "samples": [
        {
          "name": "Get Session by ID",
          "url_example": "GET /api/sessions/123e4567-e89b-12d3-a456-426614174000"
        }
      ]
    },
    "get_sessions": {
      "url": "GET /api/sessions/",
      "description": "Lấy danh sách sessions với filter",
      "samples": [
        {
          "name": "Get All Sessions",
          "url_example": "GET /api/sessions/"
        },
        {
          "name": "Get Entry Sessions Only",
          "url_example": "GET /api/sessions/?gate=In&limit=50"
        },
        {
          "name": "Get Exit Sessions Only",
          "url_example": "GET /api/sessions/?gate=Out&limit=50"
        }
      ]
    },
    "update_session_out_status": {
      "url": "PATCH /api/sessions/{session_id}/out",
      "description": "Đánh dấu session đã ra",
      "samples": [
        {
          "name": "Mark Session as Out",
          "url_example": "PATCH /api/sessions/123e4567-e89b-12d3-a456-426614174000/out"
        }
      ]
    },
    "get_session_by_plate": {
      "url": "GET /api/sessions/plate/{plate_number}/session",
      "description": "Lấy session theo biển số xe",
      "samples": [
        {
          "name": "Get Session by Plate Number",
          "url_example": "GET /api/sessions/plate/29A-12345/session"
        }
      ]
    },
    "create_matching_verify": {
      "url": "POST /api/sessions/matching-verify",
      "description": "Lưu kết quả xác thực face matching",
      "samples": [
        {
          "name": "Save Matching Result - Match",
          "url_example": "POST /api/sessions/matching-verify?session_id=123e4567-e89b-12d3-a456-426614174000&is_match=true"
        },
        {
          "name": "Save Matching Result - No Match",
          "url_example": "POST /api/sessions/matching-verify?session_id=123e4567-e89b-12d3-a456-426614174000&is_match=false"
        }
      ]
    },
    "create_session_mapping": {
      "url": "POST /api/sessions/session-map",
      "description": "Tạo mapping giữa session vào và ra",
      "samples": [
        {
          "name": "Create Session Mapping",
          "url_example": "POST /api/sessions/session-map?entry_session_id=123e4567-e89b-12d3-a456-426614174000&exit_session_id=987fcdeb-51d8-43a7-b123-987654321000"
        }
      ]
    },
    "process_plate_detection": {
      "url": "POST /api/sessions/plate-detection",
      "description": "Xử lý nhận diện biển số",
      "samples": [
        {
          "name": "Process Plate Detection",
          "payload": {
            "session_id": "123e4567-e89b-12d3-a456-426614174000",
            "plate_url": "https://res.cloudinary.com/demo/image/upload/v1234567890/plates/plate_001.jpg"
          }
        }
      ]
    },
    "update_session_fields": {
      "url": "POST /api/sessions/update-session",
      "description": "Cập nhật các trường của session",
      "samples": [
        {
          "name": "Update Plate Number",
          "url_example": "POST /api/sessions/update-session?session_id=123e4567-e89b-12d3-a456-426614174000",
          "payload": {
            "plateNumber": "29A-12345"
          }
        }
      ]
    }
  },
  "parking_endpoints": {
    "create_parking_slot": {
      "url": "POST /api/parking/slots",
      "description": "Tạo parking slot mới",
      "samples": [
        {
          "name": "Create Available Slot",
          "payload": {
            "location_code": "A01",
            "is_occupied": false
          }
        },
        {
          "name": "Create Occupied Slot",
          "payload": {
            "location_code": "A02",
            "is_occupied": true
          }
        },
        {
          "name": "Create Multiple Slots",
          "payload": [
            {
              "location_code": "B01",
              "is_occupied": false
            },
            {
              "location_code": "B02",
              "is_occupied": false
            },
            {
              "location_code": "B03",
              "is_occupied": true
            }
          ]
        }
      ]
    },
    "get_all_parking_slots": {
      "url": "GET /api/parking/slots",
      "description": "Lấy tất cả parking slots",
      "samples": [
        {
          "name": "Get All Slots",
          "url_example": "GET /api/parking/slots"
        }
      ]
    },
    "get_available_slots": {
      "url": "GET /api/parking/slots/available",
      "description": "Lấy các parking slots trống",
      "samples": [
        {
          "name": "Get Available Slots",
          "url_example": "GET /api/parking/slots/available"
        }
      ]
    },
    "update_slot_occupancy": {
      "url": "PATCH /api/parking/slots/{slot_id}",
      "description": "Cập nhật trạng thái đỗ xe của slot",
      "samples": [
        {
          "name": "Mark Slot as Occupied",
          "url_example": "PATCH /api/parking/slots/123e4567-e89b-12d3-a456-426614174000",
          "payload": {
            "is_occupied": true
          }
        },
        {
          "name": "Mark Slot as Available",
          "url_example": "PATCH /api/parking/slots/123e4567-e89b-12d3-a456-426614174000",
          "payload": {
            "is_occupied": false
          }
        }
      ]
    },
    "get_parking_stats": {
      "url": "GET /api/parking/stats",
      "description": "Lấy thống kê parking slots",
      "samples": [
        {
          "name": "Get Parking Statistics",
          "url_example": "GET /api/parking/stats"
        }
      ]
    }
  },
  "processing_endpoints": {
    "process_entry_flow": {
      "url": "POST /api/processing/entry-flow",
      "description": "Workflow hoàn chỉnh cho xe vào",
      "samples": [
        {
          "name": "Complete Entry Flow",
          "payload": {
            "plateUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/plates/entry_plate_001.jpg",
            "faceUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/faces/entry_face_001.jpg",
            "gate": "In",
            "faceIndex": "entry_face_embedding_001"
          }
        }
      ]
    },
    "process_exit_flow": {
      "url": "POST /api/processing/exit-flow",
      "description": "Workflow hoàn chỉnh cho xe ra",
      "samples": [
        {
          "name": "Complete Exit Flow",
          "payload": {
            "plateUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/plates/exit_plate_001.jpg",
            "faceUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/faces/exit_face_001.jpg",
            "faceIndex": "entry_face_embedding_001",
            "plateNumber": "29A-12345"
          }
        }
      ]
    },
    "get_processing_status": {
      "url": "GET /api/processing/session/{session_id}/processing-status",
      "description": "Kiểm tra trạng thái xử lý của session",
      "samples": [
        {
          "name": "Check Processing Status",
          "url_example": "GET /api/processing/session/123e4567-e89b-12d3-a456-426614174000/processing-status"
        }
      ]
    },
    "get_matching_history": {
      "url": "GET /api/processing/plate/{plate_number}/matching-history",
      "description": "Lấy lịch sử matching của một biển số xe",
      "samples": [
        {
          "name": "Get Matching History",
          "url_example": "GET /api/processing/plate/29A-12345/matching-history"
        }
      ]
    }
  },
  "health_check_endpoints": {
    "root_health": {
      "url": "GET /",
      "description": "Health check cơ bản",
      "samples": [
        {
          "name": "Basic Health Check",
          "url_example": "GET /"
        }
      ]
    },
    "detailed_health": {
      "url": "GET /health",
      "description": "Health check chi tiết bao gồm Firebase connection",
      "samples": [
        {
          "name": "Detailed Health Check",
          "url_example": "GET /health"
        }
      ]
    },
    "database_schema": {
      "url": "GET /api/schema",
      "description": "Lấy cấu trúc database schema",
      "samples": [
        {
          "name": "Get Database Schema",
          "url_example": "GET /api/schema"
        }
      ]
    }
  },
  "curl_examples": {
    "entry_session_creation": {
      "description": "Tạo session xe vào (tự động nhận diện biển số)",
      "command": "curl -X POST \"http://localhost:8000/api/sessions/\" -H \"Content-Type: application/json\" -d '{\"plateUrl\": \"https://res.cloudinary.com/demo/image/upload/v1234567890/plates/plate_001.jpg\", \"faceUrl\": \"https://res.cloudinary.com/demo/image/upload/v1234567890/faces/face_001.jpg\", \"gate\": \"In\", \"faceIndex\": \"face_embedding_001\"}'",
      "expected_result": "Session được tạo với plateNumber đã được nhận diện tự động"
    },
    "exit_session_creation": {
      "description": "Tạo session xe ra",
      "command": "curl -X POST \"http://localhost:8000/api/sessions/out\" -H \"Content-Type: application/json\" -d '{\"plateUrl\": \"https://res.cloudinary.com/demo/image/upload/v1234567890/plates/plate_exit_001.jpg\", \"faceUrl\": \"https://res.cloudinary.com/demo/image/upload/v1234567890/faces/face_exit_001.jpg\", \"faceIndex\": \"face_embedding_001\", \"plateNumber\": \"29A-12345\"}'",
      "note": "plateNumber phải được lấy từ entry session"
    },
    "verify_entry_session": {
      "description": "Kiểm tra session vào đã có plateNumber",
      "command": "curl -X GET \"http://localhost:8000/api/sessions/123e4567-e89b-12d3-a456-426614174000\"",
      "expected_result": "Response chứa plateNumber != null"
    },
    "get_session_by_plate": {
      "description": "Lấy session theo biển số xe (đã tự động tạo PlateMap)",
      "command": "curl -X GET \"http://localhost:8000/api/sessions/plate/AB-1234/session\"",
      "note": "PlateMap đã được tạo tự động khi tạo entry session"
    },
    "get_sessions_by_gate": {
      "description": "Lấy sessions theo gate",
      "command": "curl -X GET \"http://localhost:8000/api/sessions/?gate=In&limit=10\""
    },
    "create_parking_slot": {
      "description": "Tạo parking slot",
      "command": "curl -X POST \"http://localhost:8000/api/parking/slots\" -H \"Content-Type: application/json\" -d '{\"location_code\": \"A01\", \"is_occupied\": false}'"
    },
    "get_parking_stats": {
      "description": "Lấy thống kê parking",
      "command": "curl -X GET \"http://localhost:8000/api/parking/stats\""
    },
    "complete_entry_flow": {
      "description": "Workflow hoàn chỉnh xe vào",
      "command": "curl -X POST \"http://localhost:8000/api/processing/entry-flow\" -H \"Content-Type: application/json\" -d '{\"plateUrl\": \"https://res.cloudinary.com/demo/image/upload/v1234567890/plates/entry_plate_001.jpg\", \"faceUrl\": \"https://res.cloudinary.com/demo/image/upload/v1234567890/faces/entry_face_001.jpg\", \"gate\": \"In\", \"faceIndex\": \"entry_face_embedding_001\"}'"
    },
    "complete_exit_flow": {
      "description": "Workflow hoàn chỉnh xe ra",
      "command": "curl -X POST \"http://localhost:8000/api/processing/exit-flow\" -H \"Content-Type: application/json\" -d '{\"plateUrl\": \"https://res.cloudinary.com/demo/image/upload/v1234567890/plates/exit_plate_001.jpg\", \"faceUrl\": \"https://res.cloudinary.com/demo/image/upload/v1234567890/faces/exit_face_001.jpg\", \"faceIndex\": \"entry_face_embedding_001\", \"plateNumber\": \"29A-12345\"}'"
    },
    "health_check": {
      "description": "Kiểm tra trạng thái hệ thống",
      "command": "curl -X GET \"http://localhost:8000/health\""
    }
  },
  "postman_collection": {
    "name": "Smart Parking Admin API",
    "description": "Collection để test Smart Parking Admin API",
    "variables": [
      {
        "key": "base_url",
        "value": "http://localhost:8000"
      },
      {
        "key": "sample_session_id",
        "value": "123e4567-e89b-12d3-a456-426614174000"
      },
      {
        "key": "sample_plate_number",
        "value": "29A-12345"
      }
    ],
    "folders": [
      {
        "name": "Session Management",
        "requests": [
          "Create Session",
          "Get Session",
          "Get Sessions",
          "Update Session Status",
          "Get Session by Plate"
        ]
      },
      {
        "name": "Parking Management",
        "requests": [
          "Create Parking Slot",
          "Get All Slots",
          "Get Available Slots",
          "Update Slot Occupancy",
          "Get Parking Stats"
        ]
      },
      {
        "name": "Processing Workflows",
        "requests": [
          "Entry Flow",
          "Exit Flow",
          "Processing Status",
          "Matching History"
        ]
      },
      {
        "name": "Health Check",
        "requests": [
          "Basic Health",
          "Detailed Health",
          "Database Schema"
        ]
      }
    ]
  },
  "test_scenarios": {
    "complete_parking_flow": {
      "description": "Kịch bản test hoàn chỉnh từ xe vào đến xe ra",
      "steps": [
        {
          "step": 1,
          "action": "Create Entry Session (tự động nhận diện biển số)",
          "method": "POST",
          "url": "/api/sessions/",
          "payload": {
            "plateUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/plates/plate_001.jpg",
            "faceUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/faces/face_001.jpg",
            "gate": "In",
            "faceIndex": "face_embedding_001"
          },
          "note": "plateNumber sẽ được tự động nhận diện và lưu vào session"
        },
        {
          "step": 2,
          "action": "Get Entry Session Status (kiểm tra plateNumber đã được update)",
          "method": "GET",
          "url": "/api/sessions/{{session_id_from_step_1}}",
          "note": "Kiểm tra session đã có plateNumber chưa"
        },
        {
          "step": 3,
          "action": "Create Exit Session với plateNumber từ entry session",
          "method": "POST",
          "url": "/api/sessions/out",
          "payload": {
            "plateUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/plates/plate_exit_001.jpg",
            "faceUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/faces/face_exit_001.jpg",
            "faceIndex": "face_embedding_001",
            "plateNumber": "{{plate_number_from_step_1}}"
          }
        },
        {
          "step": 4,
          "action": "Create Face Matching Result",
          "method": "POST",
          "url": "/api/sessions/matching-verify?session_id={{exit_session_id}}&is_match=true"
        },
        {
          "step": 5,
          "action": "Create Session Mapping",
          "method": "POST",
          "url": "/api/sessions/session-map?entry_session_id={{entry_session_id}}&exit_session_id={{exit_session_id}}"
        },
        {
          "step": 6,
          "action": "Mark Entry Session as Out",
          "method": "PATCH",
          "url": "/api/sessions/{{entry_session_id}}/out"
        }
      ]
    },
    "simplified_entry_flow": {
      "description": "Kịch bản test đơn giản cho xe vào với tự động nhận diện biển số",
      "steps": [
        {
          "step": 1,
          "action": "Create Entry Session",
          "method": "POST",
          "url": "/api/sessions/",
          "payload": {
            "plateUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/plates/plate_001.jpg",
            "faceUrl": "https://res.cloudinary.com/demo/image/upload/v1234567890/faces/face_001.jpg",
            "gate": "In",
            "faceIndex": "face_embedding_001"
          },
          "expected_result": "Session được tạo với plateNumber đã được nhận diện tự động"
        },
        {
          "step": 2,
          "action": "Verify Session Data",
          "method": "GET",
          "url": "/api/sessions/{{session_id}}",
          "expected_result": "Session có plateNumber != null"
        },
        {
          "step": 3,
          "action": "Check PlateMap",
          "method": "GET",
          "url": "/api/sessions/plate/{{plate_number}}/session",
          "expected_result": "PlateMap đã được tạo tự động"
        }
      ]
    },
    "parking_management_flow": {
      "description": "Kịch bản test quản lý parking slots",
      "steps": [
        {
          "step": 1,
          "action": "Create Multiple Parking Slots",
          "method": "POST",
          "url": "/api/parking/slots",
          "payload": {
            "location_code": "A01",
            "is_occupied": false
          }
        },
        {
          "step": 2,
          "action": "Get All Parking Slots",
          "method": "GET",
          "url": "/api/parking/slots"
        },
        {
          "step": 3,
          "action": "Get Available Slots",
          "method": "GET",
          "url": "/api/parking/slots/available"
        },
        {
          "step": 4,
          "action": "Update Slot Occupancy",
          "method": "PATCH",
          "url": "/api/parking/slots/{{slot_id}}",
          "payload": {
            "is_occupied": true
          }
        },
        {
          "step": 5,
          "action": "Get Parking Statistics",
          "method": "GET",
          "url": "/api/parking/stats"
        }
      ]
    }
  }
}